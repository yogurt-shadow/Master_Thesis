\chapter{绪论}\label{chap:introduction}

本章节主要介绍本文工作的研究背景和意义。首先，本文对一些基本概念给出定义，包括可满足性模理论问题、非线性实数理论（NRA Theory）、解空间以及符号一致胞腔。本文还会介绍目前的几种主流求解算法以及局限性，引出本文工作的研究动机。接着，本文会针对工作的几个创新点展开，详细阐述算法的设计。最后，本文将总结论文的整体结构并展望后续可行的研究方向。

\section{研究背景及意义}
随着信息技术的发展，软硬件系统的正确性和安全性日益成为人们关注的话题。现有的一些验证技术使用诸如模型检查、定理证明等手段将形式化验证问题转化成为可满足性模理论(Satisfiability Modulo Theories, SMT)问题，并通过调用求解器求解。因此，SMT求解算法的设计对工业生产、科学研究等领域具有重要意义。针对特定的约束类型，如何设计高效的求解算法，在短时间内求解更多的样例成为SMT研究的一个重点。基于此，研究一种高效求解SMT问题的算法具有很高的理论意义与实际价值。

\subsection{可满足性模理论问题(SMT Problem)}
% 介绍SMT问题
可满足性模理论问题(SMT)是一种在计算机科学中常见的问题类型，它组合了布尔可满足性问题(Satisfiability, SAT)和一些理论约束，把布尔约束拓展到了更广的范围，比如算术理论、数组和字符串理论等。每一个约束一般可以表示为由一些变量和逻辑操作符组成的公式，限制了变量的取值范围。当一组变量的赋值满足了所有约束时，当前赋值被称为SMT问题的一组解。SMT求解可以理解为寻找一组解或者证明不存在解的过程。SMT问题的一个挑战在于所包含理论的复杂性，比如算术理论、位向量理论等，不同理论需要的求解策略也不同。除此之外，SMT问题涉及到的变量个数与约束个数十分庞大，解空间规模基本上与变量及约束个数呈指数关系，这也就造成了目前的求解器很难在短时间内处理十分庞大的SMT问题的现状。

% SMT的应用
SMT问题在很多领域有广泛应用，常用于符号执行\cite{KLEE, DART}，程序验证\cite{AnalysisSymbol,VerificationSMT},程序生成\cite{synthesis1}，自动机学习\cite{Automata1,automata2}以及神经网络验证等\cite{NN1,NN2,NN3,NN4}。非线性实数理论一般广泛应用于信息物理系统\cite{CPS1,CPS2,CPS3}，程序终止条件的秩函数生成\cite{LeikeH15,HeizmannHLP13}，非线性混成自动机的分析\cite{CimattiMT12}等。一般来说，这些问题会把需要验证的条件编码成为SMT问题，然后交给后端的求解器处理。比如，在符号执行中约束包括程序的分支条件，需要对程序可能执行的每一条路径进行搜索，从而确保最终程序的状态符合给定的要求，这些条件最终被编码成为SMT问题中的约束，整个验证问题等价于编码后的全部约束是否可以同时满足，即SMT问题。

% SMT的求解
目前关于SMT的求解算法大致可以分为完备搜索算法和启发式搜索算法。完备搜索算法主要的思想是通过搜索SMT问题的一部分空间，然后在遇到冲突的情况下通过推理和回溯完成对当前冲突区域的剪枝，以避免后续搜索遇到相同冲突，算法在所有变量得到赋值后结束。一般来说，完备算法因为其很强的推理能力成为主流算法，但整体推理的时间和空间复杂度较高，面对大规模的样例容易消耗过多的计算资源。启发式方法一般借助一些人工的启发式优化策略，比如引入随机函数等，来更好地引导并完成整个搜索过程。启发式方法一般会针对特殊的约束类型采取不同的启发式策略，因此其求解效果可能会根据样例的形式不同而产生不同的效果。在处理大规模样例中，启发式效果对计算资源的消耗较少，有时会得到比完备算法更好的结果。本文接下来会重点概述几种不同算法的求解思路。

% SMT的完备算法
完备算法一般也称为系统搜索算法，可以同时处理约束可满足以及不可满足的情况。目前主流的SMT完备算法包括CDCL(T)\cite{NieuwenhuisOT06}和MCSAT算法\cite{JovanovicM12,MouraJ13}，其共同的思路是不断尝试新的赋值，在遇到冲突时通过冲突分析学习新的子句，通过不断试错缩小需要探索的解空间，直到最终找到满足所有约束的一组解，或者排除整个解空间从而证明原公式不可被满足。一般来说，不同理论需要不同的理论求解器(Theory Solver)来处理文字之间的合取关系，比如整数理论、位向量理论、非线性实数理论等。而SMT问题的析取关系一般交由SAT求解器进行处理，两者交互学习到新的子句来排除目前搜索的解空间。
除了上述两种算法之外，近年来一些其他算法也在SMT求解上取得了不错的效果，包括增量线性化(incremental linearization)\cite{Incremental2}，区间约束传播(interval constraint propagation)\cite{KhanhO12,TungKO17}和亚热带方法(subtropical method)\cite{FontaineOSV17,NalbachA23}。这些方法一般作为求解器插件使用，可以对特定的样例进行快速处理。


% SMT局部搜索方法
局部搜索算法是本文工作的重点，也是近年来提出的一种专门求解可满足样例的算法。局部搜索算法一般从一个完全赋值（所有变量都有初始赋值）开始，针对当前尚且不可满足的约束设计操作，使用评价函数筛选合适的操作进行迭代，最终通过不断在邻域中搜索输出满足所有约束的一组赋值。其主要优点是对特定样例的求解效果很好，并且能够在很短的时间内找到足够好的一组解（仅有很少的约束没有满足）。其主要缺点包括容易陷入局部最优、操作的设计和评价函数的设计较为困难等。局部搜索一般不可用于求解不可满足的样例。

\subsection{非线性实数理论}
非线性实数理论是SMT问题的一个基本算术理论，一般指任意次数并且允许实数赋值的多项式约束可满足问题。与布尔可满足问题和整数理论相比，非线性实数理论的解空间是连续的，因此一般用可行域形式来表达约束的满足条件，这也使得搜索过程可能变得冗余，增加无效搜索的次数。

非线性实数算术理论一般来自于工业生产和数学问题等。比如，在实时系统的验证中，可以利用非线性实数理论来验证系统的稳定性\cite{CPS1,CPS2,CPS3}。常见的非线性动力系统一般通过李雅普诺夫函数(Lyapunov Function)来验证系统的稳定性和状态的可达性，表现为一组多项式刻画的实数约束。此外，一些基于定理证明的方法也常使用混成霍尔逻辑等方法来验证微分方程的稳定性，需要用到非线性实数SMT求解器的支持。因此，非线性实数理论的求解对于工业生产和科学研究具有重要意义。

如前所述，SMT问题的完备算法一般是基于CDCL(T)实现的。在理论求解器方面，非线性实数理论一般需要通过柱形代数分解(cylindrical algebraic decomposition, CAD)\cite{Caviness2004QuantifierEA}进行量词消去，从而学习到特定冲突下的新子句。这方面的研究包括应用CAD的变种\cite{AbrahamDEK21}，对CAD投影设计启发式的变量顺序\cite{LiXZZ23}等。其核心思想是把$R^n$空间离散化到符号一致的胞腔上，然后通过验证多项式符号是否符合逻辑要求来判断搜索的走向。MCSAT算法深度融合了理论求解器和SAT求解器的推理部分，增加了基于变量可行域的文字推理能力，大幅缩减了不必要的搜索空间开销。

非完备算法主要包括区间约束传播和局部搜索两种方法。其中，区间约束传播指的是根据变量层面的赋值区间推断多项式的值域，从而判断某些文字的满足状态。一般来说，区间约束只能计算出函数的下界(lower bound)或者上界(upper bound)。近年来一些区间传播方法采用分支定界方法来获得更严格的多项式上下界。需要注意的是，区间约束只有当近似下的上下界仍然满足约束时才可以进行推断，因此是一种非完备算法。

% SMT的优化方法
近年来，一些基于优化方法常用来检测给定区域内是否存在符合多项式组的解，进而应用到了SMT问题上。其中，Cimatti等人的工作\cite{CimattiGLS22}首次应用全局优化的方法去寻找初始解，然后通过迭代寻找附近的可行解。Ni等人的工作也使用了优化方法去寻找可行解\cite{NiWX23}，然后通过解方程\cite{LiXZ23b}等手段求出一个精确解。

% dReal求解器
Gao等人引入$\delta$-完备($\delta-complete$)决策程序的概念\cite{GaoKC13}，并基于此设计了解决非线性约束的dReal求解器。与一般SMT求解器不同的是，dReal支持对指数函数和三角函数的求解。其中$\delta$-完备包括$\delta$-满足($\delta-sat$)和不可满足(unsat)，通过松弛输入的公式来解决更宽泛问题的效果。本工作对等式的处理（见章节\ref{chap:method2}）主要借鉴了这种松弛的想法来加速局部搜索的迭代。和dReal求解器不同的是，本算法最终仍然会返回一个严格满足所有约束的精确解。

局部搜索算法则是通过定义操作和邻域来进行扰动赋值，从而对邻近的解空间进行采样。当找到满足约束条件的赋值时，局部搜索算法停止，因此其常用来寻找可满足赋值和约束采样问题。
目前主流的局部搜索算法支持线性整数逻辑(LIA)\cite{CaiLZ22}、非线性整数逻辑(NIA)\cite{CaiLZ2023}、多线性样例(multilinear)\cite{multilinear}和部分多项式理论\cite{LiXZ23}。本文提出了第一个可以覆盖全部非线性实数理论的局部搜索算法。

% 主要工作概述
\section{论文主要工作}
本文重点关注非线性实数SMT求解。本文首先介绍非线性实数理论涉及到的计算难点，并针对这些难点设计出合适的局部搜索算法，从而达到高效求解的效果。目前算法的主要难点是求解高次多项式约束需要太多求解时间，这些样例成为本文设计局部搜索算法的重点。

本工作主要在SMT-LIB\cite{BarFT-SMTLIB}上进行试验，在可满足样例上超越了目前的主流搜索算法。算法的创新性上，本文主要考虑以下几个方面:
\begin{itemize}
    \item 考虑通过设计更好地数据结构和迭代策略，针对实数问题的操作采样进行优化，以期望可以加速整体搜索过程；
    \item 针对非线性实数特有的无理数赋值问题，如何减少多项式计算上的时间消耗;
    \item 考虑非线性问题单变量无操作的情况，在陷入停滞状态时如何继续算法的迭代。
\end{itemize}

本工作主要包括以下几个贡献：
\begin{itemize}
    \item 首先，本文通过分析非线性实数的解空间引入边界（boundary）数据结构，从而实现了可行域-分数对变量的缓存机制。本文还给出了邻居变量的定义以及边界的更新算法，从而可以保证算法的正确性以及数据结构的可复用性；
    \item 针对无理数赋值问题，本文借鉴dReal的做法，在强迫无理数赋值时引入等式松弛（relaxation）的概念，允许暂时的有理数赋值。在找到松弛解之后，本文给出了求解精确解的算法，保证了算法的正确性；
    \item 针对非线性问题独有的无单变量移动问题，本文给出了一个简单的迭代算法和前瞻策略(look-ahead)，基本避免了算法停滞的现象；
    \item 本文增加了重启策略和预处理模块，相关工具在SMT-LIb上效果良好，可以在短时间内快速找到高次多项式的可满足赋值，尤其在高次样例MBO上，本工作是相较于主流求解器而言唯一一个可以求解出可满足样例的求解器。
\end{itemize}

\section{论文组织}
本文的后续章节按照以下方式组织：

第二章：介绍SMT问题和非线性算术理论的基本概念，然后展开介绍柱形代数分解算法和实数问题的解空间，最后介绍目前求解非线性理论的主流算法和研究现状。

第三章：首先介绍以往工作的胞腔跳跃操作，然后引出可行域缓存和操作冗余的现象。接着，本文给出边界数据结构的定义，并设计了胞腔缓存机制。

第四章：引入赋值复杂度的概念，引入等式松弛和恢复算法来解决无理数赋值问题。

第五章：介绍工具的整体框架，包括预处理模块、重启策略、子句加权策略和参数设置。

第六章：设计实验，对比局部搜索算法和主流完备算法的效果，展示局部搜索算法的优势。

第七章：总结本文贡献，展望后续工作，包括局部搜索算法的改进，以及和完备算法的融合。